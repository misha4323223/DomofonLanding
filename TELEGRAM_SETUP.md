# üöÄ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –≤ Telegram

–Ø —É–∂–µ —Å–æ–∑–¥–∞–ª –≤—Å—ë –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–µ! –û—Å—Ç–∞–ª–æ—Å—å —Ç–æ–ª—å–∫–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π —á–µ—Ä–µ–∑ GitHub Actions.

---

## ‚úÖ –ß–¢–û –£–ñ–ï –ì–û–¢–û–í–û:

–í –ø—Ä–æ–µ–∫—Ç–µ —Å–æ–∑–¥–∞–Ω—ã:
- `supabase/functions/telegram-notify/index.ts` - –∫–æ–¥ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ Telegram
- `supabase/functions/telegram-webhook/index.ts` - –∫–æ–¥ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–Ω–æ–ø–æ–∫ –≤ Telegram
- `supabase/config.toml` - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Supabase
- `.github/workflows/deploy-supabase-functions.yml` - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π —á–µ—Ä–µ–∑ GitHub Actions

---

## üìã –ß–¢–û –ù–£–ñ–ù–û –°–î–ï–õ–ê–¢–¨ –í–ê–ú (3 –ø—Ä–æ—Å—Ç—ã—Ö —à–∞–≥–∞):

### **–®–∞–≥ 1: –ü–æ–ª—É—á–∏—Ç–µ Supabase Access Token**

1. –û—Ç–∫—Ä–æ–π—Ç–µ: https://supabase.com/dashboard/account/tokens
2. –ù–∞–∂–º–∏—Ç–µ **Generate New Token**
3. –î–∞–π—Ç–µ –∏–º—è: `GitHub Actions`
4. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ç–æ–∫–µ–Ω (–æ–Ω –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑!)

---

### **–®–∞–≥ 2: –î–æ–±–∞–≤—å—Ç–µ —Å–µ–∫—Ä–µ—Ç—ã –≤ Supabase**

–≠—Ç–∏ –∫–æ–º–∞–Ω–¥—ã –Ω—É–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å **–û–î–ò–ù –†–ê–ó** –Ω–∞ –≤–∞—à–µ–º –ü–ö:

```bash
# 1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Supabase CLI
npm install -g supabase

# 2. –í–æ–π–¥–∏—Ç–µ –≤ Supabase
supabase login

# 3. –°–≤—è–∂–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç
supabase link --project-ref whhlmtatsnxzovzbcnbp

# 4. –î–æ–±–∞–≤—å—Ç–µ —Å–µ–∫—Ä–µ—Ç—ã Telegram –∏ OneSignal (–ó–ê–ú–ï–ù–ò–¢–ï –Ω–∞ –≤–∞—à–∏ –¥–∞–Ω–Ω—ã–µ!)
supabase secrets set TELEGRAM_BOT_TOKEN=–≤–∞—à_—Ç–æ–∫–µ–Ω_–±–æ—Ç–∞_–∑–¥–µ—Å—å
supabase secrets set TELEGRAM_CHAT_ID=–≤–∞—à_chat_id_–∑–¥–µ—Å—å
supabase secrets set TELEGRAM_SECRET_TOKEN=$(openssl rand -hex 32)
supabase secrets set ONESIGNAL_APP_ID=–≤–∞—à_onesignal_app_id_–∑–¥–µ—Å—å
supabase secrets set ONESIGNAL_REST_API_KEY=–≤–∞—à_onesignal_rest_api_key_–∑–¥–µ—Å—å
```

**–í–∞–∂–Ω–æ:** 
- TELEGRAM_SECRET_TOKEN –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–æ–º–∞–Ω–¥–æ–π –≤—ã—à–µ –¥–ª—è –∑–∞—â–∏—Ç—ã webhook –æ—Ç –ø–æ–¥–¥–µ–ª–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤.
- SUPABASE_SERVICE_ROLE_KEY —É–∂–µ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ —Å–µ–∫—Ä–µ—Ç–∞—Ö Supabase (–æ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è Edge Functions).

**–ö–∞–∫ —É–∑–Ω–∞—Ç—å Chat ID –≥—Ä—É–ø–ø—ã:**
1. –î–æ–±–∞–≤—å—Ç–µ –±–æ—Ç–∞ –≤ –≥—Ä—É–ø–ø—É
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –ª—é–±–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –≥—Ä—É–ø–ø—É
3. –û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ: `https://api.telegram.org/bot–í–ê–®_–¢–û–ö–ï–ù/getUpdates`
4. –ù–∞–π–¥–∏—Ç–µ `"chat":{"id":-1001234567890` - —ç—Ç–æ –∏ –µ—Å—Ç—å Chat ID

---

### **–®–∞–≥ 3: –î–æ–±–∞–≤—å—Ç–µ —Å–µ–∫—Ä–µ—Ç—ã –≤ GitHub**

1. –û—Ç–∫—Ä–æ–π—Ç–µ –≤–∞—à —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –Ω–∞ GitHub
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Settings** ‚Üí **Secrets and variables** ‚Üí **Actions**
3. –ù–∞–∂–º–∏—Ç–µ **New repository secret** –∏ –¥–æ–±–∞–≤—å—Ç–µ:

   **–°–µ–∫—Ä–µ—Ç 1:**
   - Name: `SUPABASE_ACCESS_TOKEN`
   - Value: –≤–∞—à —Ç–æ–∫–µ–Ω –∏–∑ –®–∞–≥–∞ 1

   **–°–µ–∫—Ä–µ—Ç 2:**
   - Name: `SUPABASE_PROJECT_REF`
   - Value: `whhlmtatsnxzovzbcnbp`

---

### **–®–∞–≥ 4: –ó–∞–ø—É—à—Ç–µ –∫–æ–¥ –≤ GitHub**

–¢–µ–ø–µ—Ä—å –∫–æ–≥–¥–∞ –≤—ã –∑–∞–ø—É—à–∏—Ç–µ –∫–æ–¥ –≤ GitHub - —Ñ—É–Ω–∫—Ü–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–¥–µ–ø–ª–æ–∏—Ç—Å—è! üéâ

```bash
git add .
git commit -m "Add Telegram notifications"
git push
```

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–∫–ª–∞–¥–∫—É **Actions** –≤ –≤–∞—à–µ–º GitHub —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ - —Ç–∞–º —É–≤–∏–¥–∏—Ç–µ –ø—Ä–æ—Ü–µ—Å—Å –¥–µ–ø–ª–æ—è.

---

### **–®–∞–≥ 5: –ù–∞—Å—Ç—Ä–æ–π—Ç–µ Webhook –≤ Supabase Dashboard**

1. –û—Ç–∫—Ä–æ–π—Ç–µ: https://supabase.com/dashboard/project/whhlmtatsnxzovzbcnbp/database/hooks
2. –ù–∞–∂–º–∏—Ç–µ **Create a new hook**
3. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ:

   - **Name:** `telegram_notify_on_new_request`
   - **Table:** `requests`
   - **Events:** ‚úÖ —Ç–æ–ª—å–∫–æ `Insert`
   - **Type:** `HTTP Request`
   - **Method:** `POST`
   - **URL:** `https://whhlmtatsnxzovzbcnbp.supabase.co/functions/v1/telegram-notify`
   - **HTTP Headers:**
     ```
     Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndoaGxtdGF0c254em92emJjbmJwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA1NTA3OTAsImV4cCI6MjA3NjEyNjc5MH0.2BF2fOtw2_Qc8QyiApgZ_-NMVyGO8mAjDrOT9oXeYH8
     ```

4. –ù–∞–∂–º–∏—Ç–µ **Create webhook**

---

## ‚úÖ –ì–û–¢–û–í–û!

–¢–µ–ø–µ—Ä—å –ø—Ä–∏ –∫–∞–∂–¥–æ–π –Ω–æ–≤–æ–π –∑–∞—è–≤–∫–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –±—É–¥–µ—Ç –ø—Ä–∏—Ö–æ–¥–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ Telegram –≥—Ä—É–ø–ø—É!

---

## üß™ –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:

1. –ó–∞–π–¥–∏—Ç–µ –Ω–∞ —Å–∞–π—Ç: https://www.obzor71.ru
2. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É –∑–∞—è–≤–∫–∏
3. –ß–µ—Ä–µ–∑ –ø–∞—Ä—É —Å–µ–∫—É–Ω–¥ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø—Ä–∏–¥—ë—Ç –≤ Telegram –≥—Ä—É–ø–ø—É

---

## üîç –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Ñ—É–Ω–∫—Ü–∏–∏:**
```bash
supabase functions logs telegram-notify
```

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ webhook –≤ Supabase Dashboard:**
Database ‚Üí Webhooks ‚Üí –∫–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à webhook ‚Üí –ø–æ—Å–º–æ—Ç—Ä–∏—Ç–µ Logs

---

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ GitHub Actions:
- –ü—Ä–∏ –∫–∞–∂–¥–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ñ–∞–π–ª–æ–≤ –≤ `supabase/functions/` ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π
- –ú–æ–∂–µ—Ç–µ —Ç–∞–∫–∂–µ –∑–∞–ø—É—Å—Ç–∏—Ç—å –¥–µ–ø–ª–æ–π –≤—Ä—É—á–Ω—É—é: GitHub ‚Üí Actions ‚Üí Deploy Supabase Functions ‚Üí Run workflow

## üéØ –í–∞–∂–Ω–æ:

–°–µ–∫—Ä–µ—Ç—ã Telegram (`TELEGRAM_BOT_TOKEN` –∏ `TELEGRAM_CHAT_ID`) –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å **–û–î–ò–ù –†–ê–ó** —á–µ—Ä–µ–∑ CLI –Ω–∞ –≤–∞—à–µ–º –ü–ö (–®–∞–≥ 2).
–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –æ–Ω–∏ –±—É–¥—É—Ç —Ö—Ä–∞–Ω–∏—Ç—å—Å—è –≤ Supabase –∏ —Ñ—É–Ω–∫—Ü–∏—è –±—É–¥–µ—Ç –∏—Ö –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

---

## üÜï –ù–û–í–ê–Ø –§–£–ù–ö–¶–ò–Ø: –ö–Ω–æ–ø–∫–∏ –≤ Telegram –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∫–ª–∏–µ–Ω—Ç–∞–º

–¢–µ–ø–µ—Ä—å –∫ –∫–∞–∂–¥–æ–º—É —Å–æ–æ–±—â–µ–Ω–∏—é –æ –∑–∞—è–≤–∫–µ –≤ Telegram –±—É–¥—É—Ç –ø—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω—ã –∫–Ω–æ–ø–∫–∏ (–µ—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç –ø–æ–¥–ø–∏—Å–∞–ª—Å—è –Ω–∞ push —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è):
- üîµ **–í –æ–±—Ä–∞–±–æ—Ç–∫–µ**
- üöó **–ú–∞—Å—Ç–µ—Ä –≤—ã–µ—Ö–∞–ª**
- ‚úÖ **–†–µ—à–µ–Ω–∞**

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Webhook –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–Ω–æ–ø–æ–∫:

–ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è —Ñ—É–Ω–∫—Ü–∏–π –Ω—É–∂–Ω–æ **–û–î–ò–ù –†–ê–ó** –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å webhook –¥–ª—è –±–æ—Ç–∞.

**–®–∞–≥ 1:** –ü–æ–ª—É—á–∏—Ç–µ –≤–∞—à TELEGRAM_SECRET_TOKEN (—Ç–æ—Ç —á—Ç–æ –±—ã–ª —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω –≤ –®–∞–≥–µ 2):

```bash
supabase secrets list | grep TELEGRAM_SECRET_TOKEN
```

**–®–∞–≥ 2:** –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ webhook —Å —Å–µ–∫—Ä–µ—Ç–Ω—ã–º —Ç–æ–∫–µ–Ω–æ–º (–∑–∞–º–µ–Ω–∏—Ç–µ `<–í–ê–®_TELEGRAM_BOT_TOKEN>` –∏ `<–í–ê–®_SECRET_TOKEN>`):

```bash
curl -X POST "https://api.telegram.org/bot<–í–ê–®_TELEGRAM_BOT_TOKEN>/setWebhook" \
  -H "Content-Type: application/json" \
  -d '{
    "url": "https://whhlmtatsnxzovzbcnbp.supabase.co/functions/v1/telegram-webhook",
    "secret_token": "<–í–ê–®_SECRET_TOKEN>"
  }'
```

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å webhook:** –æ—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ (–∑–∞–º–µ–Ω–∏—Ç–µ `<–í–ê–®_TELEGRAM_BOT_TOKEN>`):

```
https://api.telegram.org/bot<–í–ê–®_TELEGRAM_BOT_TOKEN>/getWebhookInfo
```

### –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:

1. –ö–ª–∏–µ–Ω—Ç –æ—Å—Ç–∞–≤–ª—è–µ—Ç –∑–∞—è–≤–∫—É –Ω–∞ —Å–∞–π—Ç–µ –∏ –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –Ω–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
2. –í Telegram –ø—Ä–∏—Ö–æ–¥–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ —Å —Ç—Ä–µ–º—è –∫–Ω–æ–ø–∫–∞–º–∏
3. –í—ã –Ω–∞–∂–∏–º–∞–µ—Ç–µ –Ω–∞ –∫–Ω–æ–ø–∫—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–ú–∞—Å—Ç–µ—Ä –≤—ã–µ—Ö–∞–ª")
4. –ö–ª–∏–µ–Ω—Ç—É –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è push —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω
5. –í Telegram –ø–æ—è–≤–∏—Ç—Å—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ: "‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ"

–ï—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç –ù–ï –ø–æ–¥–ø–∏—Å–∞–ª—Å—è –Ω–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è - –∫–Ω–æ–ø–∫–∏ –Ω–µ –±—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏.
