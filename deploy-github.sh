#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –¥–µ–ø–ª–æ—è –Ω–∞ GitHub Pages
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: ./deploy-github.sh [–Ω–∞–∑–≤–∞–Ω–∏–µ-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è]

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, –ø–µ—Ä–µ–¥–∞–Ω–æ –ª–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
if [ -z "$1" ]; then
  echo "‚ùå –û—à–∏–±–∫–∞: –£–∫–∞–∂–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è!"
  echo "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: ./deploy-github.sh [–Ω–∞–∑–≤–∞–Ω–∏–µ-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è]"
  echo "–ü—Ä–∏–º–µ—Ä: ./deploy-github.sh my-awesome-site"
  exit 1
fi

REPO_NAME=$1
echo "üì¶ –ù–∞—á–∏–Ω–∞—é —Å–±–æ—Ä–∫—É —Å–∞–π—Ç–∞ –¥–ª—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è: $REPO_NAME"

# –°–æ–±–∏—Ä–∞–µ–º —Ç–æ–ª—å–∫–æ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –¥–ª—è GitHub Pages
echo "üî® –°–±–æ—Ä–∫–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞..."
npx vite build --base=/$REPO_NAME/

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —É—Å–ø–µ—à–Ω–æ—Å—Ç—å —Å–±–æ—Ä–∫–∏
if [ $? -ne 0 ]; then
  echo "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–±–æ—Ä–∫–µ!"
  exit 1
fi

echo "‚úÖ –°–±–æ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!"

# –ü—É–±–ª–∏–∫—É–µ–º –Ω–∞ GitHub Pages
echo "üöÄ –ü—É–±–ª–∏–∫–∞—Ü–∏—è –Ω–∞ GitHub Pages..."
npx gh-pages -d dist/public

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —É—Å–ø–µ—à–Ω–æ—Å—Ç—å –ø—É–±–ª–∏–∫–∞—Ü–∏–∏
if [ $? -eq 0 ]; then
  echo "‚úÖ –î–µ–ø–ª–æ–π –∑–∞–≤–µ—Ä—à–µ–Ω!"
  echo "üåê –í–∞—à —Å–∞–π—Ç –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É:"
  echo "   https://–≤–∞—à-username.github.io/$REPO_NAME/"
  echo ""
  echo "üìù –ù–µ –∑–∞–±—É–¥—å—Ç–µ:"
  echo "   1. –í–∫–ª—é—á–∏—Ç—å GitHub Pages –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è"
  echo "   2. –í—ã–±—Ä–∞—Ç—å –≤–µ—Ç–∫—É gh-pages –∫–∞–∫ –∏—Å—Ç–æ—á–Ω–∏–∫"
else
  echo "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏!"
  exit 1
fi
